# 实验报告：基于参数网格搜索与多因子过滤的稳健双均线策略研究

## 1. 项目背景与摘要 (Introduction)

在金融市场中，趋势跟踪策略是应用最为广泛的量化交易方法之一。传统的双均线策略（Dual Moving Average Crossover）通过短期均线与长期均线的交叉来捕捉市场趋势。然而，传统策略往往面临两个主要问题：一是参数选择的主观性（如固定使用 5日/10日线），二是缺乏对震荡行情的过滤，容易在非趋势行情中频繁止损。

本项目旨在利用 R 语言构建一个稳健的量化交易系统。我们以苹果公司（AAPL）最近 5 年的历史数据为样本，通过网格搜索（Grid Search）算法寻找最优均线周期组合，并引入 **RSI（相对强弱指标）** 作为辅助过滤器，以期在保证收益的同时降低回撤风险，提高策略的夏普比率（Sharpe Ratio）。

## 2. 实验目标 (Objectives)

1. **数据获取与清洗**：利用 R 语言自动获取或读取美股 AAPL 的历史交易数据。
2. **策略构建**：实现基础的双均线交叉信号逻辑。
3. **参数优化**：通过遍历不同的长短周期组合，寻找夏普比率最高的参数对。
4. **风险控制**：引入 RSI 指标过滤高位买入信号，测试其对策略稳健性的提升。
5. **绩效评估**：对比“默认参数”、“最优参数”与“最优参数+RSI过滤”三种模式的表现。

## 3. 技术路线与方法 (Methodology)

### 3.1 核心工具

本项目主要使用 R 语言进行开发，依赖以下核心扩展包：

- `quantmod`：用于金融数据的获取与预处理。
- `TTR`：用于计算 SMA（移动平均）和 RSI 等技术指标。
- `PerformanceAnalytics`：用于专业的策略绩效评估与归因分析。
- `ggplot2` & `reshape2`：用于绘制参数热力图，实现可视化分析。

### 3.2 策略逻辑 (Strategy Logic)

- **买入/持有信号**：当 **短期均线 (SMA_Short) > 长期均线 (SMA_Long)** 时，视为上升趋势，生成持有信号（Signal = 1）。
- **卖出/空仓信号**：当短期均线下穿长期均线时，视为趋势结束，生成空仓信号（Signal = 0）。
- **RSI 过滤器 (Filter)**：为了防止在超买区域追高，增加限制条件：仅当 **RSI(14) < 75** 时才允许持有头寸。若 RSI 过高，即使均线金叉也选择观望。

### 3.3 参数网格搜索 (Grid Search)

为了消除参数选择的随意性，我们构建了一个参数矩阵：

- **短期窗口范围**：5 至 40天（步长 5）
- **长期窗口范围**：30 至 100天（步长 10）
- **优化目标**：夏普比率（Sharpe Ratio），即承受单位风险所获得的超额回报。

## 4. 实验步骤与代码实现 (Implementation)

### 4.1 环境准备与数据加载

代码首先检测并安装所需的 R 包，确保运行环境一致。数据方面，脚本具备“双模”读取功能：优先读取本地清洗好的 `aapl_us_2025.csv` 文件，若文件不存在，则自动通过 API 从 Yahoo Finance 下载最近 5 年的数据。

### 4.2 核心策略函数的封装

我们将策略逻辑封装为 `run_strategy()` 函数。该函数接收价格序列、长短周期参数及是否启用 RSI 过滤作为输入，输出策略的每日收益率序列。这种模块化设计极大地简化了后续的循环调用过程。

### 4.3 执行网格搜索

通过双重 `for` 循环遍历所有可能的 `(short_p, long_p)` 组合。在循环内部，代码会自动计算每一组参数回测后的年化夏普比率，并将结果存入矩阵。

### 4.4 结果可视化与深度回测

利用 `ggplot2` 绘制参数热力图，并提取最优参数组合进行三组对比实验：

1. **基准策略**：默认参数（20/60 均线）。
2. **优化策略**：使用搜索到的最优周期参数。
3. **复合策略**：最优参数 + RSI 过滤器。
4. **市场基准**：买入并持有（Buy & Hold）AAPL 股票。

## 5. 实验结果与数据分析 (Results & Analysis)

### 5.1 参数网格搜索结果

经过对 AAPL 最近 5 年数据的全量遍历，我们找到了最优的均线参数组合：

- **最优短期均线 (Short Period)**：**5日**
- **最优长期均线 (Long Period)**：**30日**

**分析**：相比于常见的 20/60 或 50/200 组合，5/30 的组合周期较短。这表明在过去 5 年中，AAPL 的股价波动较为活跃，较灵敏的短周期策略能更及时地捕捉波段趋势，从而获得比迟钝的长周期策略更高的风险调整后收益。

### 5.2 策略绩效对比表

下表展示了四种不同情境下的关键绩效指标：

| 策略类型 | 年化收益率 (Ann. Return) | 年化波动率 (Ann. Std Dev) | 夏普比率 (Sharpe Ratio) |

| Default (20/60) | 9.35% | 17.78% | 0.5258 |

| Optimized (5/30) | 14.13% | 17.98% | 0.7860 |

| Optimized + RSI | 13.40% | 17.47% | 0.7670 |

| Benchmark (Buy&Hold) | 17.92% | 26.68% | 0.6719 |

### 5.3 深度解读

**1. 优化策略 vs. 默认策略 (Optimized vs. Default)**

- **显著提升**：使用网格搜索得到的 5/30 参数，其夏普比率从默认的 **0.5258** 飙升至 **0.7860**，年化收益率也从 9.35% 提升至 14.13%。
- **原因**：20/60 的参数对于近期的 AAPL 走势来说过于滞后，导致在趋势反转初期未能及时入场，而在震荡期又容易产生亏损信号。5/30 的灵敏度更契合当前的市场节奏。

**2. 策略 vs. 市场基准 (Strategies vs. Benchmark)**

- **风险调整后的胜利**：虽然“买入持有”策略获得了最高的绝对年化收益（17.92%），但其代价是巨大的波动风险（年化标准差高达 26.68%）。
- **更高的投资效率**：优化后的双均线策略虽然绝对收益略低，但其**夏普比率 (0.7860)** 显著高于市场基准 (**0.6719**)。这意味着策略通过规避下跌趋势（空仓期），以更小的风险代价获取了可观的回报，投资体验更佳。

**3. RSI 过滤器的作用 (Role of RSI)**

- **降低波动**：引入 RSI 过滤器后，年化波动率从 17.98% 进一步降低至 **17.47%**，是所有测试组中风险最低的。
- **收益权衡**：RSI 过滤掉了一些高位买入信号，这虽然规避了部分回撤，但也导致错过了部分强势拉升行情的尾部收益（收益率从 14.13% 微降至 13.40%）。
- **结论**：对于风险厌恶型投资者，添加 RSI 过滤器是一个有效的“防御性”增强手段。

## 6. 结论 (Conclusion)

本次实验成功构建并验证了一个基于参数优化的量化交易系统。实验数据表明：

1. **参数选择至关重要**：通过网格搜索获得的 (5, 30) 参数组合，其夏普比率较默认参数提升了约 **50%**。
2. **战胜基准的风险收益比**：尽管单纯持股 AAPL 的收益最高，但优化后的量化策略提供了更优的**风险调整后收益 (Risk-Adjusted Return)**，有效降低了资产的大幅波动。
3. **多因子协同效应**：RSI 指标的加入成功起到了“刹车片”的作用，虽然牺牲了微小的收益，但换来了整个策略体系最低的波动率。

未来改进方向可包括引入止损模块（Stop-loss）或结合市场情绪指标，以进一步提升策略在极端行情下的表现。